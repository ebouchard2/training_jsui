webpackJsonpCoveo__temporary([17],{285:function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var n=o(3),s=o(254),r=o(12),l=o(8),u=o(9),a=o(100),c=o(2),p=o(34),d=o(4),g=o(480),h=o(481),v=o(482),f=function(e){function o(t,i,n){var s=e.call(this,t,o.ID,n)||this;return s.element=t,s.options=i,s.bindings=n,s.isFirstPositionResolved=!1,s.options=u.ComponentOptions.initComponentOptions(t,o,i),s.registerDistanceQuery(),s.bind.onRootElement(a.InitializationEvents.afterComponentsInitialization,function(){return s.onAfterComponentsInitialization()}),s}return i(o,e),o.prototype.setPosition=function(t,e){this.enable(),this.latitude=t,this.longitude=e;var o={position:{latitude:t,longitude:e}};this.bind.trigger(this.element,s.DistanceEvents.onPositionResolved,o);var i=this.shouldTriggerQueryWhenPositionSet();this.isFirstPositionResolved=!0,i&&this.executeQuery()},o.prototype.getLastPositionRequest=function(){return this.lastPositionRequest||t.reject("No position request was executed yet.")},o.prototype.executeQuery=function(){this.pendingSearchEventOnCancellation?(this.usageAnalytics.logSearchEvent(this.getPendingEventOnCancellation(),this.pendingSearchEventOnCancellation.getEventMeta()),delete this.pendingSearchEventOnCancellation):this.usageAnalytics.logSearchEvent(r.analyticsActionCauseList.positionSet,{}),this.queryController.executeQuery()},o.prototype.shouldTriggerQueryWhenPositionSet=function(){var t=this.options.cancelQueryUntilPositionResolved&&!this.isFirstPositionResolved;return this.options.triggerNewQueryOnNewPosition||t},o.prototype.onAfterComponentsInitialization=function(){var t=this,e={providers:this.getProvidersFromOptions()};this.bind.trigger(this.element,s.DistanceEvents.onResolvingPosition,e),this.lastPositionRequest=this.tryGetPositionFromProviders(e.providers).then(function(e){return e?t.setPosition(e.latitude,e.longitude):t.triggerDistanceNotSet(),e}).catch(function(e){t.logger.error("An error occurred while trying to resolve the current position.",e),t.triggerDistanceNotSet()})},o.prototype.getProvidersFromOptions=function(){var t=[];return this.options.useNavigator&&t.push(new g.NavigatorPositionProvider),this.options.googleApiKey&&t.push(new h.GoogleApiPositionProvider(this.options.googleApiKey)),this.options.longitudeValue&&this.options.latitudeValue&&t.push(new v.StaticPositionProvider(this.options.latitudeValue,this.options.longitudeValue)),t},o.prototype.tryGetPositionFromProviders=function(e){var o=this;return new t(function(t,i){var n=function(){if(e.length>0){e.shift().getPosition().then(function(e){e.latitude&&e.longitude?t(e):n()}).catch(function(t){o.logger.warn("An error occurred while trying to resolve the position within a position provider.",t),n()})}else t()};n()})},o.prototype.triggerDistanceNotSet=function(){this.isFirstPositionResolved=!0,this.logger.warn("None of the given position providers could resolve the current position. The distance field will not be calculated and the distance components will be disabled until the next call to 'setPosition'."),this.bind.trigger(this.element,s.DistanceEvents.onPositionNotResolved,{}),this.disable(),this.executeQuery()},o.prototype.registerDistanceQuery=function(){var t=this;this.bind.onRootElement(a.QueryEvents.buildingQuery,function(e){if(t.isFirstPositionResolved){if(e&&e.queryBuilder){var o={function:t.getConvertedUnitsFunction("dist("+t.options.latitudeField+", "+t.options.longitudeField+", "+t.latitude+", "+t.longitude+")"),fieldName:""+t.options.distanceField};e.queryBuilder.queryFunctions.push(o),t.enableDistanceComponents()}}else t.options.cancelQueryUntilPositionResolved&&(t.pendingSearchEventOnCancellation=t.usageAnalytics.getPendingSearchEvent(),t.logger.info("Query cancelled, waiting for position."),e.cancel=!0)})},o.prototype.enableDistanceComponents=function(){var t=this;n.$$(this.root).findAll("."+this.options.disabledDistanceCssClass).forEach(function(e){try{e.classList.remove(t.options.disabledDistanceCssClass);var o=p.get(e);o&&o.enable()}catch(o){t.logger.error("Could not re-enable distance component.",o,e)}})},o.prototype.getConvertedUnitsFunction=function(t){return t+"/"+this.options.unitConversionFactor},o.prototype.getPendingEventOnCancellation=function(){return{name:this.pendingSearchEventOnCancellation.templateSearchEvent.actionCause,type:this.pendingSearchEventOnCancellation.templateSearchEvent.actionType}},o.ID="DistanceResources",o.doExport=function(){d.exportGlobally({DistanceResources:o})},o.options={distanceField:u.ComponentOptions.buildFieldOption({required:!0}),latitudeField:u.ComponentOptions.buildFieldOption({required:!0}),longitudeField:u.ComponentOptions.buildFieldOption({required:!0}),unitConversionFactor:u.ComponentOptions.buildNumberOption({defaultValue:1e3,validator:function(t){return!!t&&t>0}}),disabledDistanceCssClass:u.ComponentOptions.buildStringOption({defaultValue:"coveo-distance-disabled"}),latitudeValue:u.ComponentOptions.buildNumberOption({float:!0}),longitudeValue:u.ComponentOptions.buildNumberOption({float:!0}),googleApiKey:u.ComponentOptions.buildStringOption(),useNavigator:u.ComponentOptions.buildBooleanOption(),triggerNewQueryOnNewPosition:u.ComponentOptions.buildBooleanOption({defaultValue:!1}),cancelQueryUntilPositionResolved:u.ComponentOptions.buildBooleanOption({defaultValue:!0})},o}(l.Component);e.DistanceResources=f,c.Initialization.registerAutoCreateComponent(f)}).call(e,o(5))},480:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.getPosition=function(){return new t(function(t,e){navigator.geolocation.getCurrentPosition(function(e){t({latitude:e.coords.latitude,longitude:e.coords.longitude})},function(t){e(t)})})},e}();e.NavigatorPositionProvider=o}).call(e,o(5))},481:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(62),n=function(){function t(t){this.googleApiKey=t}return t.prototype.getPosition=function(){return(new i.EndpointCaller).call({errorsAsSuccess:!1,method:"POST",queryString:["key="+this.googleApiKey],requestData:{},responseType:"json",url:"https://www.googleapis.com/geolocation/v1/geolocate"}).then(function(t){var e=t.data.location;return{longitude:e.lng,latitude:e.lat}})},t}();e.GoogleApiPositionProvider=n},482:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(t,e){this.latitude=t,this.longitude=e}return e.prototype.getPosition=function(){return t.resolve({longitude:this.longitude,latitude:this.latitude})},e}();e.StaticPositionProvider=o}).call(e,o(5))}});